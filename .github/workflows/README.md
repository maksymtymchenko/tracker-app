# GitHub Actions Workflows

## Build and Release Workflow

This workflow automatically builds and uploads your app to Cloudflare R2 when you push a version tag.

### Setup

1. **Create Cloudflare R2 API Token:**

   - Go to Cloudflare Dashboard → R2 → Manage R2 API Tokens
   - Create a new API token with read/write permissions for your bucket
   - Note down:
     - Access Key ID
     - Secret Access Key
     - Account ID
     - Your bucket name

2. **Add GitHub Secrets:**

   - Go to your GitHub repository → Settings → Secrets and variables → Actions
   - Click "New repository secret"
   - Add the following secrets:
     - `CLOUDFLARE_ACCESS_KEY_ID`: Your R2 Access Key ID
     - `CLOUDFLARE_SECRET_ACCESS_KEY`: Your R2 Secret Access Key
     - `R2_BUCKET_NAME`: Your bucket name (e.g., `pub-783c37b34b55408d998282fd1a2781f6`)
     - `R2_ENDPOINT`: Your R2 endpoint URL (e.g., `https://<account-id>.r2.cloudflarestorage.com`)

   **To find your R2 endpoint:**

   - Go to Cloudflare Dashboard → R2
   - Click on your bucket
   - Look for "S3 API" section
   - The endpoint will be: `https://<account-id>.r2.cloudflarestorage.com`

   **Important Notes:**

   - `R2_BUCKET_NAME` should be your bucket name (e.g., `pub-783c37b34b55408d998282fd1a2781f6`)
   - `R2_ENDPOINT` is the S3-compatible API endpoint, NOT the public R2.dev URL
   - The public URL (`https://pub-783c37b34b55408d998282fd1a2781f6.r2.dev`) is only for accessing files, not for API calls

   **Example:**

   - If your account ID is `abc123def456`, your endpoint would be: `https://abc123def456.r2.cloudflarestorage.com`
   - Your bucket name might be: `pub-783c37b34b55408d998282fd1a2781f6`

### Usage

The workflow triggers automatically on:

- **Push to main/master branch** - Builds and uploads on every commit
- **Version tags** (e.g., `v0.1.1`) - Builds and uploads when you push a tag
- **Manual trigger** - Run from GitHub Actions tab

1. **Update version in package.json (optional for tag releases):**

   ```json
   {
     "version": "0.1.1"
   }
   ```

2. **Push to main branch:**

   ```bash
   git add .
   git commit -m "Update app"
   git push origin main
   ```

   Or create and push a version tag:

   ```bash
   git tag v0.1.1
   git push origin v0.1.1
   ```

3. **The workflow will:**
   - Build the app for Windows and macOS
   - Upload `latest.yml` (and `latest-win.yml`, `latest-mac.yml`) to R2 in the `tracker-app-auto-update/` subdirectory
   - Upload all installer files to R2 in the `tracker-app-auto-update/` subdirectory
   - Make them available for auto-update at: `https://pub-783c37b34b55408d998282fd1a2781f6.r2.dev/tracker-app-auto-update/`

### Manual Trigger

You can also manually trigger the workflow:

- Go to Actions tab in GitHub
- Select "Build and Release" workflow
- Click "Run workflow"

### Notes

- The workflow extracts the version from the tag (removes 'v' prefix if present)
- Files are uploaded with their original names to the `tracker-app-auto-update/` subdirectory
- The `latest.yml` files are automatically generated by electron-builder
- Make sure your R2 bucket has public read access enabled
- The app is configured to check for updates at: `https://pub-783c37b34b55408d998282fd1a2781f6.r2.dev/tracker-app-auto-update/`
